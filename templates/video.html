<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>æ•™å­¸å½±ç‰‡å€</title>
    <link rel="stylesheet" href="/static/video.css">
    <style>
        /* æ›¸ç±æ¨è–¦é¢æ¿æ¨£å¼ */
        .book-recommendations {
            position: fixed;
            top: 60px;
            right: 20px;
            width: 320px;
            max-height: 70vh;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 20px;
            overflow-y: auto;
            z-index: 1000;
            border: 1px solid #e0e6ed;
            font-family: 'Microsoft JhengHei', sans-serif;
        }

        .book-recommendations h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .book-item {
            display: flex;
            margin-bottom: 15px;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            background: #fafbfc;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .book-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: #f0f7ff;
        }

        .book-cover {
            width: 60px;
            height: 80px;
            background: #ddd;
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 12px;
            text-align: center;
            background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .book-info {
            flex: 1;
        }

        .book-title {
            font-weight: 600;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .book-author {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 6px;
        }

        .book-description {
            font-size: 12px;
            color: #555;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-source {
            font-size: 10px;
            color: #3498db;
            margin-top: 4px;
            font-style: italic;
        }

        .loading-books {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }

        .no-books {
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            padding: 20px;
        }

        .keywords-display {
            background: #ecf0f1;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #2c3e50;
        }

        .keywords-display strong {
            color: #3498db;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 1400px) {
            .book-recommendations {
                width: 280px;
            }
        }

        @media (max-width: 1200px) {
            .book-recommendations {
                position: relative;
                top: 0;
                right: 0;
                width: 100%;
                max-height: none;
                margin-top: 20px;
            }
        }

        /* èª¿æ•´ä¸»å®¹å™¨ä»¥é©æ‡‰æ›¸ç±æ¨è–¦é¢æ¿ */
        .container {
            margin-right: 340px;
        }

        @media (max-width: 1200px) {
            .container {
                margin-right: 0;
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="topbar">
        <div class="system-title">æ©Ÿå™¨å­¸ç¿’æ•™å­¸å¹³å°</div>
        <div>
            <span class="user-label">æ­¡è¿ï¼Œ{{ username }}</span>
            <a href="{{ url_for('dashboard') }}" class="logout-link">AIå°è©±</a>
            <a href="{{ url_for('logout') }}" class="logout-link">ç™»å‡º</a>
        </div>
    </div>

    <!-- æ›¸ç±æ¨è–¦é¢æ¿ -->
    <div class="book-recommendations" id="bookRecommendations">
        <h3>ğŸ“š ç›¸é—œæ›¸ç±æ¨è–¦</h3>
        <div id="booksList">
            <div class="no-books">é–‹å§‹å°è©±å³å¯ç²å¾—æ›¸ç±æ¨è–¦ âœ¨</div>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <h2>æ©Ÿå™¨å­¸ç¿’ &gt;</h2>

            <!-- è³‡æ–™é è™•ç† -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    è³‡æ–™é è™•ç†
                    <span class="arrow">&#9660;</span> <!-- â–¼ -->
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/eFqX6miUkNE">è³‡æ–™é è™•ç† #1</button>
                    <button data-src="https://www.youtube.com/embed/7pDI5BrnzT0">è³‡æ–™é è™•ç† #2</button>
                    <button data-src="https://www.youtube.com/embed/Wm2WW-9ucec">è³‡æ–™é è™•ç† #3</button>
                    <button data-src="https://www.youtube.com/embed/rlp3WCKh8nA">è³‡æ–™é è™•ç† #4</button>
                    <button data-src="https://www.youtube.com/embed/2m6G80E769s">è³‡æ–™é è™•ç† #5</button>
                </div>
            </div>

            <!-- ç°¡å–®ç·šæ€§å›æ­¸ -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    ç°¡å–®ç·šæ€§å›æ­¸
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/TlQph9btXXg">ç°¡å–®ç·šæ€§å›æ­¸ #1</button>
                    <button data-src="https://www.youtube.com/embed/0OrQEy0PUu8">ç°¡å–®ç·šæ€§å›æ­¸ #2</button>
                    <button data-src="https://www.youtube.com/embed/Z5Qr1WCm-0s">ç°¡å–®ç·šæ€§å›æ­¸ #3</button>
                    <button data-src="https://www.youtube.com/embed/HVv2T2_X6_I">ç°¡å–®ç·šæ€§å›æ­¸ #4</button>
                </div>
            </div>

            <!-- å¤šå…ƒç·šæ€§å›æ­¸ -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    å¤šå…ƒç·šæ€§å›æ­¸
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/S4DZyq6YnXE">å¤šå…ƒç·šæ€§å›æ­¸ #1</button>
                    <button data-src="https://www.youtube.com/embed/ycDNXdt4B9s">å¤šå…ƒç·šæ€§å›æ­¸ #2</button>
                    <button data-src="https://www.youtube.com/embed/_azK56iLmS4">å¤šå…ƒç·šæ€§å›æ­¸ #3</button>
                </div>
            </div>

            <!-- å¤šé …å¼å›æ­¸ -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    å¤šé …å¼å›æ­¸
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/rmrnBM3mVsQ">å¤šé …å¼å›æ­¸ #1</button>
                    <button data-src="https://www.youtube.com/embed/_q5SyL82Vc8">å¤šé …å¼å›æ­¸ #2</button>
                </div>
            </div>

            <!-- R Squared -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    R Squared
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/Pa2oVPYPQYY">R Squared (Rå¹³æ–¹)</button>
                    <button data-src="https://www.youtube.com/embed/H8OVpXKnh5c">R Squaredä»‹ç´¹</button>
                    <button data-src="https://www.youtube.com/embed/ewNrzR5s3E8">Adjusted R Squared (èª¿æ•´Rå¹³æ–¹)ä¿‚æ•¸</button>
                    <button data-src="https://www.youtube.com/embed/vOCB46P_WCM">Adjusted R Squaredä»‹ç´¹</button>
                </div>
            </div>

            <!-- Support Vector Machine -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    Support Vector Machine
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/afDRvWxobP8">SVMä»‹ç´¹</button>
                    <button data-src="https://www.youtube.com/embed/teJ-9ihjmcI">SVM Pythonå¯¦å‹™æ“ä½œ</button>
                    <button data-src="https://www.youtube.com/embed/namj9uIwjaE">SVM Pythonå¯¦å‹™æ“ä½œ (ä½¿ç”¨MNISTè³‡æ–™é›†åˆ)</button>
                </div>
            </div>

            <!-- Naive Bayes -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    Naive Bayes(å–®ç´”è²æ°åˆ†é¡å™¨)
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/1bc7EOx48mo">Naive Bayesä»‹ç´¹ Part 1</button>
                    <button data-src="https://www.youtube.com/embed/tlJfftcWMCw">Naive Bayesä»‹ç´¹ Part 2</button>
                    <button data-src="https://www.youtube.com/embed/nqrkfeaq3tU">Naive Bayesä»‹ç´¹ Part 3</button>
                </div>
            </div>

            <!-- Decision Tree(æ±ºç­–æ¨¹) -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    Decision Tree(æ±ºç­–æ¨¹)
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/bE2yMLKJFbk">Decision Treeä»‹ç´¹ Part 1</button>
                    <button data-src="https://www.youtube.com/embed/yfDLN82D6Gc">Decision Treeä»‹ç´¹ Part 2</button>
                    <button data-src="https://www.youtube.com/embed/Pwp7dxlv5MY">Decision Tree Pythonå¯¦ä½œ</button>
                    <button data-src="https://www.youtube.com/embed/WWjZb38YIHE">Decision Treeä»‹ç´¹ Part 3</button>
                </div>
            </div>

            <!-- Random Forest (éš¨æ©Ÿæ£®æ—) -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    Random Forest (éš¨æ©Ÿæ£®æ—)
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/wIXMzMsjULQ">Random Forest (éš¨æ©Ÿæ£®æ—)</button>
                    <button data-src="https://www.youtube.com/embed/3U8N5sPdQPk">Random Forest (éš¨æ©Ÿæ£®æ—) Pythonå¯¦ä½œ</button>
                </div>
            </div>

            <!-- K-Means (Kå¹³å‡) -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    K-Means (Kå¹³å‡)
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/A5gK564vHmE">K-Means (Kå¹³å‡) Part 1</button>
                    <button data-src="https://www.youtube.com/embed/13g6powgeUM">K-Means (Kå¹³å‡) Part 2</button>
                    <button data-src="https://www.youtube.com/embed/F16VusxMMSU">K-Means (Kå¹³å‡) Part 3</button>
                    <button data-src="https://www.youtube.com/embed/4oP318KqXGo">K-Means (Kå¹³å‡) Pythonå¯¦ä½œ</button>
                </div>
            </div>

            <!-- K-Fold Cross Validation (äº¤å‰é©—è­‰)  -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    K-Fold Cross Validation (äº¤å‰é©—è­‰)
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/sRV18JVtBQI">K-Fold Cross Validation (äº¤å‰é©—è­‰)
                        #1</button>
                    <button data-src="https://www.youtube.com/embed/DPcFlzF9zSk">K-Fold Cross Validation (äº¤å‰é©—è­‰)
                        #2</button>
                </div>
            </div>

            <!-- Grid Search (ç¶²æ ¼æœå°‹)  -->
            <div class="dropdown">
                <button class="dropdown-btn">
                    Grid Search (ç¶²æ ¼æœå°‹)
                    <span class="arrow">&#9660;</span>
                </button>
                <div class="dropdown-content">
                    <button data-src="https://www.youtube.com/embed/k1xsoog2y3Q">Grid Search (ç¶²æ ¼æœå°‹) Pythonå¯¦ä½œ</button>
                </div>
            </div>

            <!-- AI æ©Ÿå™¨äººæŒ‰éˆ• -->
            <button class="aiRobot-btn" onclick="toggleChat()" title="é–‹å•Ÿ AI èŠå¤©">
                <img src="/static/aiRobot.png" alt="AI æ©Ÿå™¨äºº" />
            </button>

            <!-- å°è©±è¦–çª— -->
            <div id="chatWindow" class="chat-window hidden">
                <div class="chat-header">
                    AI æ©Ÿå™¨äºº ğŸ¤–
                    <button class="close-btn" onclick="toggleChat()">âœ–</button>
                </div>
                <div class="chat-messages" id="chat-messages"></div>
                <form id="chat-form" class="chat-form" autocomplete="off">
                    <input id="chat-input" type="text" placeholder="è¼¸å…¥è¨Šæ¯..." required />
                    <button type="submit">ç™¼é€</button>
                    <button type="button" id="clearBtn">æ¸…é™¤</button>
                </form>
            </div>
        </div>

        <!-- å½±ç‰‡èˆ‡èŠå¤©å€ -->
        <main class="main">
            <h2>æ©Ÿå™¨å­¸ç¿’ - è³‡æ–™é è™•ç† #1 by åœ‹ç«‹å±æ±å¤§å­¸æ—å½¥å»·è€å¸«</h2>
            <div class="video-wrapper">
                <!-- ä½ å¯ä»¥æ›æˆ <video> or iframe -->
                <iframe id="videoPlayer" width="100%" height="100%" src="https://www.youtube.com/embed/eFqX6miUkNE"
                    frameborder="0" allowfullscreen>
                </iframe>
            </div>
        </main>
    </div>

    <script>
        // æ›¸ç±æ¨è–¦åŠŸèƒ½
        async function getBookRecommendations(userMessage) {
            try {
                const response = await fetch('/get_book_recommendations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage }),
                });

                const data = await response.json();
                displayBookRecommendations(data.books, data.keywords);
            } catch (error) {
                console.error('ç²å–æ›¸ç±æ¨è–¦å¤±æ•—:', error);
            }
        }
        function displayBookRecommendations(books, keywords) {
            const booksList = document.getElementById('booksList');

            if (!books || books.length === 0) {
                booksList.innerHTML = '<div class="no-books">æš«ç„¡ç›¸é—œæ›¸ç±æ¨è–¦</div>';
                return;
            }

            let html = '';

            if (keywords) {
                html += `<div class="keywords-display"><strong>é—œéµè©:</strong> ${keywords}</div>`;
            }

            books.forEach(book => {
                html += `
                    <a id = "bookstore" href="${book.link}">
                       <div class="book-item">
                        <img class="book-cover" src="${book.image}" alt="${book.title}">
                        <div class="book-info">
                            <div class="book-title">${book.title}</div>
                            <div class="book-author">ä½œè€…: ${book.author}</div>
                            <div class="book-source">${book.source || 'æ¨è–¦æ›¸ç±'}</div>
                        </div>
                    </div> 
                    </a>
                `;
            });

            booksList.innerHTML = html;
        }

        function showBookLoading() {
            const booksList = document.getElementById('booksList');
            booksList.innerHTML = '<div class="loading-books">ğŸ” æ­£åœ¨æœå°‹ç›¸é—œæ›¸ç±...</div>';
        }

        // ç¶œåˆæ‰€æœ‰ DOMContentLoaded çš„åˆå§‹åŒ–å…§å®¹ç‚ºä¸€æ®µï¼Œé¿å…é‡è¤‡èˆ‡æ½›åœ¨é †åºéŒ¯èª¤
        window.addEventListener("DOMContentLoaded", function () {
            // dropdown é»æ“Šå±•é–‹/æ”¶åˆ
            const dropdowns = document.querySelectorAll(".dropdown-btn");
            dropdowns.forEach(btn => {
                btn.addEventListener("click", function () {
                    const content = this.nextElementSibling;
                    const arrow = this.querySelector(".arrow");
                    const isOpen = content.style.display === "block";
                    content.style.display = isOpen ? "none" : "block";
                    arrow.innerHTML = isOpen ? "&#9660;" : "&#9650;"; // â–¼ â–²
                });
            });

            // é»æ“Šå½±ç‰‡æŒ‰éˆ•åˆ‡æ› iframe src èˆ‡æ¨™é¡Œ + active æ¨£å¼åˆ‡æ›
            const buttons = document.querySelectorAll(".dropdown-content button");
            const iframe = document.getElementById("videoPlayer");
            buttons.forEach(btn => {
                btn.addEventListener("click", function () {
                    const videoUrl = this.getAttribute("data-src");
                    iframe.src = videoUrl;

                    const title = document.querySelector(".main h2");
                    title.textContent = "æ©Ÿå™¨å­¸ç¿’ - " + this.textContent + " by åœ‹ç«‹å±æ±å¤§å­¸æ—å½¥å»·è€å¸«";

                    buttons.forEach(b => b.classList.remove("active"));
                    this.classList.add("active");
                });
            });

            // sidebar æ»¾å‹•ç‰¹æ•ˆ
            const sidebar = document.querySelector('.sidebar');
            sidebar.addEventListener('mouseenter', () => sidebar.classList.add('scrollable'));
            sidebar.addEventListener('mouseleave', () => sidebar.classList.remove('scrollable'));

            // åˆå§‹æ­¡è¿è¨Šæ¯èˆ‡æ­·å²ç´€éŒ„è¼‰å…¥
            addMessage('ai', 'ä½ å¥½ï¼æœ‰ä»€éº¼æˆ‘å¯ä»¥å¹«å¿™çš„å—ï¼Ÿ');
            fetch('/chat/history')
                .then(res => res.json())
                .then(history => {
                    if (Array.isArray(history)) {
                        for (const msg of history) addMessage(msg.role, msg.content);
                    } else if (history.error) {
                        addMessage('ai', 'âš ï¸ ç„¡æ³•è¼‰å…¥æ­·å²ç´€éŒ„ï¼š' + history.error);
                    }
                })
                .catch(() => addMessage('ai', 'âš ï¸ è¼‰å…¥ç´€éŒ„æ™‚å‡ºéŒ¯ã€‚'));
        });

        // åˆ‡æ›èŠå¤©è¦–çª—é¡¯ç¤º/éš±è—
        function toggleChat() {
            const chatWindow = document.getElementById("chatWindow");
            const botBtn = document.querySelector(".aiRobot-btn");
            const isHidden = chatWindow.classList.contains("hidden");
            chatWindow.classList.toggle("hidden", !isHidden);
            botBtn.style.display = isHidden ? "none" : "block";
        }

        // åŠ å…¥è¨Šæ¯è‡³èŠå¤©æ¡†
        function addMessage(sender, text) {
            const chatMessages = document.getElementById('chat-messages');
            const messageRow = document.createElement("div");
            messageRow.classList.add("message-row", sender);
            const bubble = document.createElement("div");
            bubble.classList.add("bubble", sender);
            bubble.textContent = text;
            messageRow.appendChild(bubble);
            chatMessages.appendChild(messageRow);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // æ¸…é™¤èŠå¤©ç´€éŒ„èˆ‡è¼¸å…¥æ¡†
        const clearBtn = document.getElementById('clearBtn');
        clearBtn.addEventListener('click', async () => {
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            chatMessages.innerHTML = '';
            chatInput.value = '';

            // æ¸…é™¤æ›¸ç±æ¨è–¦
            const booksList = document.getElementById('booksList');
            booksList.innerHTML = '<div class="no-books">é–‹å§‹å°è©±å³å¯ç²å¾—æ›¸ç±æ¨è–¦ âœ¨</div>';

            try {
                const res = await fetch('/chat/clear', { method: 'POST' });
                const result = await res.json();
                if (result.success) {
                    addMessage('ai', 'ä½ å¥½ï¼æœ‰ä»€éº¼æˆ‘å¯ä»¥å¹«å¿™çš„å—ï¼Ÿ');
                } else {
                    addMessage('ai', 'æ¸…é™¤ç´€éŒ„å¤±æ•—ï¼š' + (result.error || 'æœªçŸ¥éŒ¯èª¤'));
                }
            } catch (e) {
                addMessage('ai', 'æ¸…é™¤ä¼ºæœå™¨ç´€éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤');
                console.error(e);
            }
        });

        // æäº¤è¨Šæ¯è™•ç†
        const chatForm = document.getElementById('chat-form');
        chatForm.addEventListener('submit', async function (e) {
            e.preventDefault();
            const chatInput = document.getElementById('chat-input');
            const text = chatInput.value.trim();
            if (!text) return;

            // åŠ å…¥ä½¿ç”¨è€…è¨Šæ¯
            addMessage('user', text);
            chatInput.value = '';
            chatInput.focus();

            // é¡¯ç¤ºæ›¸ç±æ¨è–¦è¼‰å…¥ç‹€æ…‹
            showBookLoading();

            // é¡¯ç¤º AI è¼¸å…¥ä¸­ï¼ˆä¸‰å€‹é»å‹•ç•«ï¼‰
            const chatMessages = document.getElementById('chat-messages');
            const typingRow = document.createElement("div");
            typingRow.classList.add("message-row", "ai");
            typingRow.setAttribute("id", "typingIndicator");

            const typingBubble = document.createElement("div");
            typingBubble.classList.add("bubble", "ai", "typing");
            typingBubble.innerHTML = "<span></span><span></span><span></span>";

            typingRow.appendChild(typingBubble);
            chatMessages.appendChild(typingRow);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                // åŒæ™‚ç™¼é€èŠå¤©å’Œæ›¸ç±æ¨è–¦è«‹æ±‚
                const [chatResponse, bookResponse] = await Promise.all([
                    fetch('/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: text }),
                    }),
                    getBookRecommendations(text)
                ]);

                const chatData = await chatResponse.json();

                // ç§»é™¤è¼¸å…¥ä¸­æç¤º
                const typingEl = document.getElementById("typingIndicator");
                if (typingEl) typingEl.remove();

                // åŠ å…¥ AI çœŸæ­£çš„å›è¦†
                if (chatData.reply) {
                    addMessage('ai', chatData.reply);
                } else if (chatData.error) {
                    addMessage('ai', 'éŒ¯èª¤ï¼š' + chatData.error);
                }
            } catch (error) {
                // ç§»é™¤è¼¸å…¥ä¸­æç¤º
                const typingEl = document.getElementById("typingIndicator");
                if (typingEl) typingEl.remove();

                addMessage('ai', 'ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');

                // å¦‚æœèŠå¤©å¤±æ•—ï¼Œä¹Ÿæ¸…é™¤æ›¸ç±æ¨è–¦çš„è¼‰å…¥ç‹€æ…‹
                const booksList = document.getElementById('booksList');
                booksList.innerHTML = '<div class="no-books">ç²å–æ¨è–¦å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
            }
        });

        // æ‹–æ›³èŠå¤©è¦–çª—
        window.addEventListener("DOMContentLoaded", () => {
            const chatWindow = document.getElementById("chatWindow");
            const chatHeader = chatWindow.querySelector(".chat-header");
            let isDragging = false;
            let offsetX = 0;
            let offsetY = 0;

            chatHeader.addEventListener("mousedown", (e) => {
                isDragging = true;
                offsetX = e.clientX - chatWindow.offsetLeft;
                offsetY = e.clientY - chatWindow.offsetTop;
                chatWindow.style.transition = "none";
            });

            document.addEventListener("mousemove", (e) => {
                if (isDragging) {
                    chatWindow.style.left = `${e.clientX - offsetX}px`;
                    chatWindow.style.top = `${e.clientY - offsetY}px`;
                    chatWindow.style.bottom = "auto";
                    chatWindow.style.right = "auto";
                    chatWindow.style.position = "fixed";
                }
            });

            document.addEventListener("mouseup", () => {
                isDragging = false;
                chatWindow.style.transition = "";
            });
        });
    </script>

</body>

</html>